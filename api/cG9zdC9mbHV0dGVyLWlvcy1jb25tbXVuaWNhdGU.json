{"title":"Flutteré¡µé¢è·³è½¬åˆ°IOSåŸç”Ÿç•Œé¢   å¦‚ä½•å®ç°ï¼Ÿ","date":"2019-07-10T16:23:23.000Z","author":"JamesğŸ’","thumbnail":"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1562931729970&di=a2a33d1ea44ad1fbfbb9495c658d0926&imgtype=0&src=http%3A%2F%2F2e.zol-img.com.cn%2Fproduct%2F129_500x370%2F466%2FceLvj6nNCps.jpg","link":"post/flutter-ios-conmmunicate","tags":["Flutter","Native"],"categories":["Flutter"],"updated":"2019-07-12T08:54:21.668Z","content":"<p>2019å¹´åˆçš„æ—¶å€™ï¼Œæˆ‘å­¦è¿‡ä¸€é˜µå­Flutterï¼Œç€é‡çœ‹äº†ä¸‹Bloc(business logic component),è‡ªå·±å†™äº†ä¸ªå°demoã€‚å®Œäº†ä¹‹åï¼ŒFlutterå°±è¢«æŠ›ä¹‹è„‘åäº†ã€‚   </p>\n<p>è¿™ä¸¤å¤©ï¼Œæœ‰æœ‹å‹è¯·æˆ‘å¸®å¿™ï¼Œä»–ä»¬æƒ³ä»Flutteré¡µé¢è·³è½¬åˆ°IOSåŸç”ŸOCçš„ç•Œé¢ï¼Œè™½ç„¶æˆ‘ä¸æ˜¯å¤§ç¥ï¼Œåªæ˜¯ä¸€åªé‡ç”Ÿçš„çŒ¿ï¼Œä½†æˆ‘å–œæ¬¢æŒ‘æˆ˜ï¼Œç­”åº”å¸®ä»–ä»¬çœ‹çœ‹ã€‚è¯´å¹²å°±å¹²ï¼Œå‚è€ƒäº†å®˜ç½‘çš„å…³äºç¼–å†™è·¨å¹³å°ä»£ç æ–‡æ¡£ï¼š<a href=\"https://flutter.dev/docs/development/platform-integration/platform-channels\" target=\"_blank\" rel=\"noopener\">ä¼ é€é—¨</a><br><img src=\"https://user-gold-cdn.xitu.io/2019/7/11/16be0ec744b6b714?w=580&h=647&f=png&s=23232\" alt></p>\n<p>å…¶å®åŸºæœ¬æ€è·¯å¾ˆç®€å•ï¼Œä¸¤æ­¥</p>\n<p>ä¸€.Flutter ä¼ é€’æ¶ˆæ¯ç»™åŸç”Ÿï¼Œè¯´æˆ‘è¦å»åŸç”Ÿç•Œé¢</p>\n<p>äºŒ.åœ¨åŸç”ŸAppDelegate.mé‡Œï¼Œå°†FlutterViewController ä½œä¸ºrootViewControllerï¼Œç„¶åæ”¾åœ¨Navigation Stacké‡Œã€‚å½“åŸç”Ÿæ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œå®ç°è·³è½¬åŠŸèƒ½ï¼Œå®Œäº‹ï¼</p>\n<p>è¯ä¸å¤šè¯´ï¼ŒLetâ€™s dive in.</p>\n<h3 id=\"ç¬¬ä¸€æ­¥ï¼ŒFlutter-æ€ä¹ˆå°†æ¶ˆæ¯ä¼ é€’åˆ°åŸç”Ÿç«¯å‘¢ï¼Ÿ\">ç¬¬ä¸€æ­¥ï¼ŒFlutter æ€ä¹ˆå°†æ¶ˆæ¯ä¼ é€’åˆ°åŸç”Ÿç«¯å‘¢ï¼Ÿ<a href=\"post/flutter-ios-conmmunicate#ç¬¬ä¸€æ­¥ï¼ŒFlutter-æ€ä¹ˆå°†æ¶ˆæ¯ä¼ é€’åˆ°åŸç”Ÿç«¯å‘¢ï¼Ÿ\"></a></h3><p>1.åˆ›å»ºä¸€ä¸ªé€šä¿¡çš„é¢‘é“</p>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &apos;dart:async&apos;;</span><br><span class=\"line\">import &apos;package:flutter/material.dart&apos;;</span><br><span class=\"line\">import &apos;package:flutter/services.dart&apos;;</span><br><span class=\"line\">...</span><br><span class=\"line\">class _MyHomePageState extends State&lt;MyHomePage&gt; &#123;</span><br><span class=\"line\">  static const platform = const MethodChannel(&apos;samples.flutter.dev/goToNativePage&apos;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>2.å®ç°Trigger Function</p>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Future&lt;void&gt; _goToNativePage() async &#123;</span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">      final int result = await platform</span><br><span class=\"line\">          .invokeMethod(&apos;goToNativePage&apos;, &#123;&apos;test&apos;: &apos;from flutter&apos;&#125;);</span><br><span class=\"line\">      print(result);</span><br><span class=\"line\">    &#125; on PlatformException catch (e) &#123;&#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">@override</span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    return Material(</span><br><span class=\"line\">      child: Center(</span><br><span class=\"line\">        child: Column(</span><br><span class=\"line\">          mainAxisAlignment: MainAxisAlignment.spaceEvenly,</span><br><span class=\"line\">          children: [</span><br><span class=\"line\">            RaisedButton(</span><br><span class=\"line\">              child: Text(&apos;å»åŸç”Ÿç•Œé¢&apos;),</span><br><span class=\"line\">              onPressed: _goToNativePage,</span><br><span class=\"line\">              color: Colors.blueAccent,</span><br><span class=\"line\">              textColor: Colors.white,</span><br><span class=\"line\">            ),</span><br><span class=\"line\">            Text(</span><br><span class=\"line\">              &quot;Flutter é¡µé¢&quot;,</span><br><span class=\"line\">              style: new TextStyle(</span><br><span class=\"line\">                fontSize: 30.0,</span><br><span class=\"line\">                fontWeight: FontWeight.w900,</span><br><span class=\"line\">                fontFamily: &quot;Georgia&quot;,</span><br><span class=\"line\">              ),</span><br><span class=\"line\">            )</span><br><span class=\"line\">          ],</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œç»™è¿™æŒ‰é’®å†æ·»åŠ ä¸€ä¸ª_goToNativePageæ–¹æ³•ï¼Œåœ¨è¿™é‡Œå¦‚æœè¿˜è¦ä¼ é€’å‚æ•°çš„è¯ï¼Œç›´æ¥åƒè¿™æ ·å†™å°±okäº†  </p>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">platform.invokeMethod(&apos;goToNativePage&apos;, &#123;&apos;key&apos;: &apos;value&apos;&#125;);</span><br></pre></td></tr></table></div></figure>\n\n<h3 id=\"ç¬¬äºŒæ­¥-ï¼ŒåŸç”Ÿæ¥æ”¶æ¶ˆæ¯å¹¶å®ç°è·³è½¬\">ç¬¬äºŒæ­¥ ï¼ŒåŸç”Ÿæ¥æ”¶æ¶ˆæ¯å¹¶å®ç°è·³è½¬<a href=\"post/flutter-ios-conmmunicate#ç¬¬äºŒæ­¥-ï¼ŒåŸç”Ÿæ¥æ”¶æ¶ˆæ¯å¹¶å®ç°è·³è½¬\"></a></h3><p>å› ä¸ºä½ å¯¼èˆªåˆ°æ–°ç•Œé¢ï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥<code>UINavigationController</code></p>\n<p>åœ¨AppDelegate.mé‡Œï¼Œ<code>@implementation AppDelegate</code>ä¸Šæ–¹æ·»åŠ ä»£ç </p>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@interface AppDelegate()</span><br><span class=\"line\">  @property (nonatomic, strong) UINavigationController *navigationController;</span><br><span class=\"line\">@end</span><br></pre></td></tr></table></div></figure>\n\n<p>1.å°†FlutterViewè®¾ä¸ºæ ¹è§†å›¾</p>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FlutterViewController *controller = (FlutterViewController*)self.window.rootViewController;</span><br></pre></td></tr></table></div></figure>\n\n<p>2.åµŒå…¥å¯¼èˆªå †æ ˆé‡Œ</p>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">self.navigationController = [[UINavigationController alloc] initWithRootViewController:controller];</span><br><span class=\"line\">self.window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];</span><br><span class=\"line\">self.window.rootViewController = self.navigationController;</span><br><span class=\"line\">[self.navigationController setNavigationBarHidden:YES animated:YES];</span><br><span class=\"line\">[self.window makeKeyAndVisible];</span><br></pre></td></tr></table></div></figure>\n\n<p>3.Flutterå’ŒåŸç”Ÿé€šä¿¡çš„æ¥å£çš„å®ç°</p>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FlutterMethodChannel* testChannel = </span><br><span class=\"line\">        [</span><br><span class=\"line\">             FlutterMethodChannel methodChannelWithName:@&quot;samples.flutter.dev/goToNativePage&quot;</span><br><span class=\"line\">             binaryMessenger:controller</span><br><span class=\"line\">        ];</span><br><span class=\"line\">\t</span><br><span class=\"line\">[testChannel setMethodCallHandler:^(FlutterMethodCall* call, FlutterResult result) &#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tNSLog(@&quot;%@&quot;, call.method);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t//æ¥æ”¶ä»flutterä¼ é€’è¿‡æ¥çš„å‚æ•°</span><br><span class=\"line\">\tNSLog(@&quot;%@&quot;, call.arguments[@&quot;test&quot;]);</span><br><span class=\"line\"></span><br><span class=\"line\">\tif ([@&quot;goToNativePage&quot; isEqualToString:call.method]) &#123;</span><br><span class=\"line\">        //å®ç°è·³è½¬çš„ä»£ç </span><br><span class=\"line\">\t&#125; else &#123;</span><br><span class=\"line\">\t\tresult(FlutterMethodNotImplemented);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></div></figure>\n\n<p>æƒ³è·å–ä»flutterä¼ é€’è¿‡æ¥çš„å‚æ•°ï¼Œ <code>call.arguments[@&quot;key&quot;]</code>,ç”¨è¿™æ®µä»£ç </p>\n<p>4.å®ç°è·³è½¬åˆ°åŸç”Ÿç•Œé¢  </p>\n<p>åˆ°äº†è¿™ï¼Œå°±ç›¸å½“ç®€å•äº†ï¼Œè¡¥å…¨è·³è½¬ä»£ç </p>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NSString * storyboardName = @&quot;Main&quot;;</span><br><span class=\"line\">UIStoryboard *storyboard = [UIStoryboard storyboardWithName:storyboardName bundle: nil];</span><br><span class=\"line\">UIViewController * vc = [storyboard instantiateViewControllerWithIdentifier:@&quot;NativeViewController&quot;];</span><br><span class=\"line\">vc.navigationItem.title = call.arguments[@&quot;test&quot;];</span><br><span class=\"line\"></span><br><span class=\"line\">[self.navigationController pushViewController:vc animated:true];</span><br></pre></td></tr></table></div></figure>\n\n<p>gayhub é¡¹ç›®åœ°å€ï¼š<a href=\"https://github.com/JamesInGod/flutter-native-oc\" target=\"_blank\" rel=\"noopener\">ä¼ é€é—¨</a><br>IOS Swiftç‰ˆæœ¬ï¼š<a href=\"https://github.com/JamesInGod/flutter-native-swift\" target=\"_blank\" rel=\"noopener\">ä¼ é€é—¨</a></p>\n<p>åˆ°äº†è¿™é‡Œï¼ŒåŠŸèƒ½å°±å®ç°äº†ã€‚å¦‚æœæœ‰æ›´å¥½æ–¹å¼ï¼Œè¯·å‘Šè¯‰æˆ‘.</p>\n","next":{"title":"è¶…ç®€å•ï¼IOSï¼Œåœ¨Appä¸­ä½¿ç”¨Safariæ‰“å¼€ç½‘é¡µï¼ˆswiftï¼‰","link":"post/ios-safariview"},"plink":"http://yoursite.com/post/flutter-ios-conmmunicate/"}